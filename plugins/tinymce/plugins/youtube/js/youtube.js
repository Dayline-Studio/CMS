var youTube=function(e,t,n,r){function i(e){var t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return t&&t[2].length===11?t[2]:false}function s(e){if(e.match(/((http|https):\/\/[^< ]+)/g)){if(e.match(new RegExp("http://","g"))){ssl_url=e.replace(/^http:\/\//i,"https://")}else{ssl_url=e}return ssl_url}else{console.log(e+" is not URL")}}function o(e,t){var n=new Array("https://www.youtube.com/v/","http://www.youtube.com/embed/");var r;switch(t){case"embed":r=n[0];break;case"iframe":r=n[1];break}if(e!=""){if(s(e).match(new RegExp("https://www.youtube.com/","g"))){yurl=s(e).replace(s(e),r+i(s(e)))}else if(e.match(new RegExp("http://youtu.be/","g"))){yurl=e.replace("http://youtu.be/",r)}else{yurl=false}return yurl}}function u(e,t,n){if(n!=false){var r='width="'+t[0]+'"';var i='height="'+t[1]+'"';switch(e){case"embed":var s='<div class="youtube">';s+='<object type="application/x-shockwave-flash" '+r+i+' data="'+n+"&modestbranding=1"+'">';s+='<param name="movie" value="'+n+"&modestbranding=1"+'" />';s+='<param name="wmode" value="transparent" />';s+="</object>";s+="</div>";break;case"iframe":var s='<iframe src="'+n+'" '+r+i+' frameborder="0" allowfullscreen>‚Å™&nbsp;</iframe>';break}return s}}function a(){var t="",n=e("#video").is(":checked"),i=e("#youtubeAutoplay").is(":checked"),s=e("#youtubeREL").is(":checked"),a=e("#youtubeHD").is(":checked");switch(i){case false:t+="";break;case true:t+="&autoplay=1";break;default:t+="";break}switch(s){case false:t+="";break;case true:t+="&rel=0";break;default:t+="";break}switch(a){case false:t+="";break;case true:t+="&hd=1";break;default:t+="";break}var f=e("#youtubeWidth").val();var l=e("#youtubeHeight").val();if(n!=false){var c=o(e("#youtubeID").val(),"iframe")}else{var c=o(e("#youtubeID").val(),"embed")}if(c!==r||c!==false){if(n!=false){return u("iframe",[f,l],c)}else{return u("embed",[f,l],c+t)}}}function f(e,t){if(this.timer)clearTimeout(this.timer);this.timer=setTimeout(t,e?e:1e3)}return{preview:function(){e("#preview").html(u("embed",[420,315],o(e("#youtubeID").val(),"embed")))},run:function(){if(a()){parent.tinymce.activeEditor.insertContent(a());parent.tinymce.activeEditor.windowManager.close()}else{parent.tinymce.activeEditor.windowManager.close()}},runPreview:function(){if(e("#preview").length!=0){e("#youtubeID").keypress(function(){f("","youTube.preview();")}).change(function(){f(100,"youTube.preview();")})}}}}(jQuery,window,document);$(function(){var e={youtubeurl:parent.tinymce.util.I18n.translate("Youtube URL"),youtubeID:parent.tinymce.util.I18n.translate("Youtube ID"),youtubeWidth:parent.tinymce.util.I18n.translate("width"),youtubeHeight:parent.tinymce.util.I18n.translate("height"),youtubeAutoplay:parent.tinymce.util.I18n.translate("autoplay"),youtubeHD:parent.tinymce.util.I18n.translate("HD video"),youtubeREL:parent.tinymce.util.I18n.translate("Related video")};$.get("view/forms.html",function(t){filled=Mustache.render(t,e);$("#template-container").append(filled);youTube.runPreview();$("#insert-btn").on("click",function(){youTube.run()})})})